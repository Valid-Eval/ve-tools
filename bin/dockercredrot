#!/usr/bin/env python
import sh
import click
import json

def gen_json(registry, username, token, email, auth):
  elem = {
    "auths": {
      registry: {
        "username": username,
        "password": token,
        "email": email,
        "auth": auth
      }
    }
  }
  return json.dumps(elem, separators=(',', ':'))

def gen_auth(username, token):
  auth = "%s:%s\n" % (username, token)
  return sh.base64(_in=auth).strip()

@click.command()
@click.argument('registry')
@click.argument('username')
@click.argument('token')
@click.argument('email')
def main(registry, username, token, email):
  auth = gen_auth(username, token)
  json = gen_json(registry, username, token, email, auth)
  print(sh.base64(_in="%s\n" % json))

if __name__ == '__main__':
  main()